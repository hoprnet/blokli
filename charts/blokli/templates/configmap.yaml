apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "blokli.fullname" . }}
  labels:
    {{- include "blokli.labels" . | nindent 4 }}
data:
  config.toml: |
    # Blokli Configuration
    # Generated by Helm chart

    # Server configuration
    host = "0.0.0.0:{{ .Values.service.port }}"

    # Database configuration
    [database]
    type = {{ required "You must set .Values.database.type " .Values.database.type | quote }}
    max_connections = {{ .Values.database.maxConnections }}

    # Data storage
    data_directory = "{{ .Values.config.dataDirectory }}"

    # Network configuration
    network = "{{ .Values.config.network }}"
    max_rpc_requests_per_sec = {{ .Values.config.maxRpcRequestsPerSec }}

    # Indexer settings
    [indexer]
    fast_sync = {{ .Values.config.indexer.fastSync }}
    {{- if .Values.config.indexer.enableLogsSnapshot }}
    enable_logs_snapshot = {{ .Values.config.indexer.enableLogsSnapshot }}
    logs_snapshot_url = "{{ required "config.indexer.logsSnapshotUrl is required" .Values.config.indexer.logsSnapshotUrl }}"
    {{- end }}

    # Indexer subscription configuration
    [indexer.subscription]
    event_bus_capacity = {{ .Values.config.indexer.subscription.eventBusCapacity }}
    shutdown_signal_capacity = {{ .Values.config.indexer.subscription.shutdownSignalCapacity }}
    batch_size = {{ .Values.config.indexer.subscription.batchSize }}

    # API server configuration
    [api]
    enabled = {{ .Values.config.api.enabled }}
    bind_address = "{{ .Values.config.api.bindAddress }}"
    playground_enabled = {{ .Values.config.api.playgroundEnabled }}

    # Health check configuration
    [api.health]
    max_indexer_lag = {{ .Values.config.api.health.maxIndexerLag }}
    timeout_ms = {{ .Values.config.api.health.timeoutMs }}
