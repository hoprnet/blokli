# Example configuration for bloklid daemon
# This serves as a complete working example showing all available options

# Directory for storing data files
data_directory = "data"

# Network identifier - specifies which HOPR network to connect to
# Supported networks: rotsee (default, testnet), anvil-localhost (local development)
# Case-insensitive: anvil_localhost, anvil-localhost, and localhost are also accepted
network = "rotsee"

# RPC endpoint URL for connecting to the blockchain
# Overrides the default RPC endpoint for the selected network
# If not specified, uses the network's default RPC endpoint (default: http://localhost:8545)
rpc_url = "http://localhost:8545"

# Maximum number of RPC requests per second (0 for unlimited)
# Overrides the default rate limit for the selected network
# If not specified, uses the network's default rate limit
max_rpc_requests_per_sec = 0

# Maximum block range for RPC queries when fetching logs (default: 10000)
# Must be greater than 0. Lower values may be needed for some RPC providers
# that impose limits on the number of blocks per query
max_block_range = 10000

# Optional contract address overrides
# Defaults are resolved from hopr-bindings for the selected network
# Use this when running against a local chain with freshly deployed contracts
# [contracts]
# token = "0x0000000000000000000000000000000000000000"
# channels = "0x0000000000000000000000000000000000000000"
# announcements = "0x0000000000000000000000000000000000000000"
# module_implementation = "0x0000000000000000000000000000000000000000"
# node_safe_migration = "0x0000000000000000000000000000000000000000"
# node_safe_registry = "0x0000000000000000000000000000000000000000"
# ticket_price_oracle = "0x0000000000000000000000000000000000000000"
# winning_probability_oracle = "0x0000000000000000000000000000000000000000"
# node_stake_factory = "0x0000000000000000000000000000000000000000"

# Database configuration - supports PostgreSQL or SQLite
# IMPORTANT: This section is OPTIONAL if using environment variables.
# For environment-only configuration, comment out this entire [database] section and set:
#   - BLOKLI_DATABASE_TYPE=postgresql
#   - BLOKLI_DATABASE_URL=postgresql://user:password@host:port/database
#   - BLOKLI_DATABASE_MAX_CONNECTIONS=10 (optional, defaults to 10)

[database]
# PostgreSQL configuration (recommended for production)
type = "postgresql"

# Option 1: Simple connection URL (recommended)
url = "postgresql://bloklid:password@localhost:5432/bloklid"

# Option 2: Detailed configuration (comment out url above and uncomment fields below)
# host = "localhost"
# port = 5432
# username = "bloklid"
# password = "password"
# database = "bloklid"
# max_connections = 10

# SQLite configuration (alternative to PostgreSQL)
# SQLite uses two separate database files to avoid write lock contention:
# - Index database: accounts, channels, announcements, node_info, chain_info
# - Logs database: log, log_status, log_topic_info tables
# To use SQLite: comment out the PostgreSQL [database] section above, then uncomment this block
# [database]
# type = "sqlite"
# index_path = "data/bloklid-index.db"  # Use ":memory:" for in-memory database
# logs_path = "data/bloklid-logs.db"    # Use ":memory:" for in-memory database
# max_connections = 10

# Indexer configuration
[indexer]
# Enable fast sync mode for initial synchronization
fast_sync = true

# Enable downloading logs snapshot for faster initial sync
enable_logs_snapshot = false

# URL to download logs snapshot from (optional)
logs_snapshot_url = "https://example.com/logs-snapshot.tar.xz"

# GraphQL subscription behavior configuration
[indexer.subscription]
# Capacity of the event bus buffer for channel events
# Higher values prevent overflow but use more memory (default: 1000)
event_bus_capacity = 1000

# Capacity of the shutdown signal buffer
# Typically a small value is sufficient (default: 10)
shutdown_signal_capacity = 10

# Batch size for Phase 1 historical channel queries
# Higher values fetch more data per query but may increase latency (default: 100)
batch_size = 100

# API server configuration
[api]
# Enable or disable the GraphQL API server (default: true)
enabled = true

# Address and port for the API server to bind to (default: "0.0.0.0:8080")
bind_address = "0.0.0.0:8080"

# Enable GraphQL Playground for development and testing (default: true)
playground_enabled = true

# SSE keepalive configuration
[api.sse_keepalive]
# Enable keepalive comments to prevent idle timeouts (default: true)
enabled = true
# Interval between keepalive comments (default: 15s)
interval = "15s"
# Comment text sent for keepalive messages (default: "keep-alive")
text = "keep-alive"

# Health check configuration for Kubernetes probes
[api.health]
# Maximum allowed indexer lag before the server reports "not ready"
#
# This limit is compared against finality-adjusted blocks from the RPC:
#   lag = (rpc_block - finality) - indexed_block
#
# For Rotsee (Gnosis), finality=3 blocks. So with max_indexer_lag=10:
# - The indexer can be up to 13 blocks behind the RPC chain head
# - But must be within 10 blocks of confirmed blocks (with 3 confirmations)
#
# This ensures the server doesn't report "ready" when caught up to
# unconfirmed blocks that might be reorganized.
#
# Default: 10 blocks
max_indexer_lag = 10

# Timeout for health check queries (default: 5s)
timeout = "5s"

# Interval for periodic readiness checks (default: 60s)
# This controls how often the cached readiness state is updated by a background task
# Set lower for faster detection of readiness changes, higher to reduce I/O overhead
readiness_check_interval = "60s"
