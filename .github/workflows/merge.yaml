name: Merge PR
on:
  pull_request:
    types:
      - closed
      # - synchronize
concurrency:
  group: merge
  cancel-in-progress: false
jobs:
  build-docker:
    name: Build Docker
    if: github.event.pull_request.merged == true
    uses: ./.github/workflows/build-docker.yaml
    with:
      source_branch: ${{ github.event.pull_request.base.ref }}
      version_type: "pr"
    secrets: inherit
  build_binaries:
    strategy:
      fail-fast: false
      matrix:
        target:
          - name: x86_64-linux
            runner: self-hosted-hoprnet-bigger
    name: Binary
    uses: ./.github/workflows/build-binaries.yaml
    with:
      source_branch: ${{ github.event.pull_request.base.ref }}
      runner: ${{ matrix.target.runner }}
      architecture: ${{ matrix.target.name }}
      version_type: pr
    secrets: inherit
