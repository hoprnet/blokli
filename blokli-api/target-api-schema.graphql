"""
Human-readable token representation.
Format: value [wei] token
Examples:
  10 wei wxHOPR
	10 wxHOPR
	10.1 wxHOPR
	.1 wxHOPR
"""
scalar TokenValueString

"""
Blockchain and HOPR network information
"""
type ChainInfo {
	"Current block number of the blockchain"
	blockNumber: Int!
	"Chain ID of the connected blockchain network"
	chainId: Int!
	"Current HOPR token price"
	ticketPrice: TokenValueString!
	"Current minimum ticket winning probability (decimal value between 0.0 and 1.0)"
	minTicketWinningProbability: Float!
}

enum Token {
	"HOPR token"
	HOPR
	"Native token"
	NATIVE
}

"""
HOPR token balance information for a specific address
"""
type HoprBalance {
	"Address holding the HOPR token balance"
	address: String!
	"HOPR token balance"
	balance: TokenValueString!
}

"""
Native token balance information for a specific address
"""
type NativeBalance {
	"Address holding the native token balance"
	address: String!
	"Native token balance"
	balance: TokenValueString!
}

"""
Account information containing balances and multiaddresses
"""
type Account {
	"Unique identifier for the account"
	keyid: Int!
	"Unique account on-chain address in hexadecimal format"
	chainKey: String!
	"Unique account packet key in peer id format"
	packetKey: String!
	"wxHOPR balance associated with the on-chain address"
	accountHoprBalance: TokenValueString!
	"Native balance associated with the on-chain address"
	accountNativeBalance: TokenValueString!
	"HOPR Safe contract address to which the account is linked"
	safeAddress: String
	"wxHOPR balance associated with the linked Safe contract address"
	safeHoprBalance: TokenValueString
	"Native balance associated with the linked Safe contract address"
	safeNativeBalance: TokenValueString
	"List of multiaddresses associated with the packet key"
	multiAddresses: [String!]!
}

"""
Status of a payment channel
"""
enum ChannelStatus {
	"Channel is open and operational"
	OPEN
	"Channel is in the process of closing"
	PENDINGTOCLOSE
	"Channel has been closed"
	CLOSED
}

"""
Payment channel between two nodes
"""
type Channel {
	"Unique identifier for the payment channel in hexadecimal format"
	concreteChannelId: String!
	"Account keyid of the source node"
	source: Int!
	"Account keyid of the destination node"
	destination: Int!
	"Total amount of HOPR tokens allocated to the channel"
	balance: TokenValueString!
	"Current state of the channel (OPEN, PENDINGTOCLOSE, or CLOSED)"
	status: ChannelStatus!
	"Current epoch of the channel"
	epoch: Int!
	"Latest ticket index used in the channel"
	ticketIndex: Int!
	"Seconds until the channel is closed once closure is initiated"
	closureTime: Int!
}

"""
Graph of opened payment channels with associated accounts
"""
type OpenedChannelsGraph {
	"List of all open payment channels"
	channels: [Channel!]!
	"List of accounts referenced by the open channels (source and destination nodes)"
	accounts: [Account!]!
}

type QueryRoot {
	"""
	Retrieve all accounts from the database

	Returns a complete list of all accounts. No filtering is available.
	"""
	accounts: [Account!]!
	"""
	Retrieve channels, optionally filtered by source and/or destination

	If neither source nor destination is provided, returns all channels.
	If source is provided, filters channels by source address.
	If destination is provided, filters channels by destination address.
	Both filters can be combined to find specific channels.
	"""
	channels(
		"Filter by source node address (hexadecimal format)"
		source: String,
		"Filter by destination node address (hexadecimal format)"
		destination: String
	): [Channel!]!

	"""
	Retrieve the opened channels graph

	Returns all open channels along with the accounts that participate in those channels.
	This provides a complete view of the active payment channel network.
	"""
	openedChannelsGraph: OpenedChannelsGraph!

	"""
	Retrieve HOPR token balance for a specific address

	Returns None if no balance exists for the address.
	"""
	hoprBalance(
		"On-chain address to query (hexadecimal format)"
		address: String!
	): HoprBalance
	"""
	Retrieve native token balance for a specific address

	Returns None if no balance exists for the address.
	"""
	nativeBalance(
		"On-chain address to query (hexadecimal format)"
		address: String!
	): NativeBalance
	"""
	Health check endpoint

	Returns "ok" to indicate the service is running
	"""
	health: String!
	"""
	API version information

	Returns the current version of the blokli-api package
	"""
	version: String!

	"""
	Retrieve chain information
	"""
	chainInfo: ChainInfo!
}

type SubscriptionRoot {
	"""
	Subscribe to real-time updates of native balances for a specific address

	Provides updates whenever there is a change in the native token balance for the specified account.
	Updates are sent immediately when balance changes occur on-chain.
	"""
	nativeBalanceUpdated(
		"On-chain address to monitor for balance changes (hexadecimal format)"
		address: String!
	): NativeBalance!

	"""
	Subscribe to real-time updates of HOPR balances for a specific address

	Provides updates whenever there is a change in the HOPR token balance for the specified account.
	Updates are sent immediately when balance changes occur on-chain.
	"""
	hoprBalanceUpdated(
		"On-chain address to monitor for balance changes (hexadecimal format)"
		address: String!
	): HoprBalance!

	"""
	Subscribe to real-time updates of payment channels

	Provides updates whenever there is a change in the state of any payment channel,
	including channel opening, balance updates, status changes, and channel closure.
	"""
	channelUpdated: Channel!

	"""
	Subscribe to real-time updates of account information

	Provides updates whenever there is a change in account information, including
	balance changes, Safe address linking, and multiaddress announcements.
	"""
	accountUpdated: Account!
}

schema {
	query: QueryRoot
	subscription: SubscriptionRoot
}
